(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const Xt=(t,e)=>t===e,Zt=Symbol("solid-track"),Oe={equals:Xt};let wt=bt;const k=1,ve=2,Nt={owned:null,cleanups:null,context:null,owner:null};var T=null;let Ie=null,qt=null,g=null,C=null,V=null,Re=0;function _e(t,e){const n=g,s=T,i=t.length===0,o=e===void 0?s:e,r=i?Nt:{owned:null,cleanups:null,context:o?o.context:null,owner:o},c=i?t:()=>t(()=>W(()=>Ce(r)));T=r,g=null;try{return ce(c,!0)}finally{g=n,T=s}}function $e(t,e){e=e?Object.assign({},Oe,e):Oe;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=i=>(typeof i=="function"&&(i=i(n.value)),Lt(n,i));return[Mt.bind(n),s]}function ie(t,e,n){const s=Xe(t,e,!1,k);ue(s)}function ct(t,e,n){wt=en;const s=Xe(t,e,!1,k);(!n||!n.render)&&(s.user=!0),V?V.push(s):ue(s)}function He(t,e,n){n=n?Object.assign({},Oe,n):Oe;const s=Xe(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=n.equals||void 0,ue(s),Mt.bind(s)}function W(t){if(g===null)return t();const e=g;g=null;try{return t()}finally{g=e}}function It(t){return T===null||(T.cleanups===null?T.cleanups=[t]:T.cleanups.push(t)),t}function Mt(){if(this.sources&&this.state)if(this.state===k)ue(this);else{const t=C;C=null,ce(()=>Ae(this),!1),C=t}if(g){const t=this.observers?this.observers.length:0;g.sources?(g.sources.push(this),g.sourceSlots.push(t)):(g.sources=[this],g.sourceSlots=[t]),this.observers?(this.observers.push(g),this.observerSlots.push(g.sources.length-1)):(this.observers=[g],this.observerSlots=[g.sources.length-1])}return this.value}function Lt(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&ce(()=>{for(let i=0;i<t.observers.length;i+=1){const o=t.observers[i],r=Ie&&Ie.running;r&&Ie.disposed.has(o),(r?!o.tState:!o.state)&&(o.pure?C.push(o):V.push(o),o.observers&&Dt(o)),r||(o.state=k)}if(C.length>1e6)throw C=[],new Error},!1)),e}function ue(t){if(!t.fn)return;Ce(t);const e=Re;Qt(t,t.value,e)}function Qt(t,e,n){let s;const i=T,o=g;g=T=t;try{s=t.fn(e)}catch(r){return t.pure&&(t.state=k,t.owned&&t.owned.forEach(Ce),t.owned=null),t.updatedAt=n+1,xt(r)}finally{g=o,T=i}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Lt(t,s):t.value=s,t.updatedAt=n)}function Xe(t,e,n,s=k,i){const o={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:T,context:T?T.context:null,pure:n};return T===null||T!==Nt&&(T.owned?T.owned.push(o):T.owned=[o]),o}function pe(t){if(t.state===0)return;if(t.state===ve)return Ae(t);if(t.suspense&&W(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Re);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===k)ue(t);else if(t.state===ve){const s=C;C=null,ce(()=>Ae(t,e[0]),!1),C=s}}function ce(t,e){if(C)return t();let n=!1;e||(C=[]),V?n=!0:V=[],Re++;try{const s=t();return Jt(n),s}catch(s){n||(V=null),C=null,xt(s)}}function Jt(t){if(C&&(bt(C),C=null),t)return;const e=V;V=null,e.length&&ce(()=>wt(e),!1)}function bt(t){for(let e=0;e<t.length;e++)pe(t[e])}function en(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:pe(s)}for(e=0;e<n;e++)pe(t[e])}function Ae(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const s=t.sources[n];if(s.sources){const i=s.state;i===k?s!==e&&(!s.updatedAt||s.updatedAt<Re)&&pe(s):i===ve&&Ae(s,e)}}}function Dt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=ve,n.pure?C.push(n):V.push(n),n.observers&&Dt(n))}}function Ce(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const o=i.pop(),r=n.observerSlots.pop();s<i.length&&(o.sourceSlots[r]=s,i[s]=o,n.observerSlots[s]=r)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ce(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function tn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function xt(t,e=T){throw tn(t)}const nn=Symbol("fallback");function dt(t){for(let e=0;e<t.length;e++)t[e]()}function sn(t,e,n={}){let s=[],i=[],o=[],r=0,c=e.length>1?[]:null;return It(()=>dt(o)),()=>{let a=t()||[],d,u;return a[Zt],W(()=>{let f=a.length,h,_,E,p,A,O,v,I,b;if(f===0)r!==0&&(dt(o),o=[],s=[],i=[],r=0,c&&(c=[])),n.fallback&&(s=[nn],i[0]=_e(zt=>(o[0]=zt,n.fallback())),r=1);else if(r===0){for(i=new Array(f),u=0;u<f;u++)s[u]=a[u],i[u]=_e(l);r=f}else{for(E=new Array(f),p=new Array(f),c&&(A=new Array(f)),O=0,v=Math.min(r,f);O<v&&s[O]===a[O];O++);for(v=r-1,I=f-1;v>=O&&I>=O&&s[v]===a[I];v--,I--)E[I]=i[v],p[I]=o[v],c&&(A[I]=c[v]);for(h=new Map,_=new Array(I+1),u=I;u>=O;u--)b=a[u],d=h.get(b),_[u]=d===void 0?-1:d,h.set(b,u);for(d=O;d<=v;d++)b=s[d],u=h.get(b),u!==void 0&&u!==-1?(E[u]=i[d],p[u]=o[d],c&&(A[u]=c[d]),u=_[u],h.set(b,u)):o[d]();for(u=O;u<f;u++)u in E?(i[u]=E[u],o[u]=p[u],c&&(c[u]=A[u],c[u](u))):i[u]=_e(l);i=i.slice(0,r=f),s=a.slice(0)}return i});function l(f){if(o[u]=f,c){const[h,_]=$e(u);return c[u]=_,e(a[u],h)}return e(a[u])}}}function G(t,e){return W(()=>t(e||{}))}const on=t=>`Stale read from <${t}>.`;function Me(t){const e="fallback"in t&&{fallback:()=>t.fallback};return He(sn(()=>t.each,t.children,e||void 0))}function de(t){const e=t.keyed,n=He(()=>t.when,void 0,{equals:(s,i)=>e?s===i:!s==!i});return He(()=>{const s=n();if(s){const i=t.children;return typeof i=="function"&&i.length>0?W(()=>i(e?s:()=>{if(!W(n))throw on("Show");return t.when})):i}return t.fallback},void 0,void 0)}function rn(t,e,n){let s=n.length,i=e.length,o=s,r=0,c=0,a=e[i-1].nextSibling,d=null;for(;r<i||c<o;){if(e[r]===n[c]){r++,c++;continue}for(;e[i-1]===n[o-1];)i--,o--;if(i===r){const u=o<s?c?n[c-1].nextSibling:n[o-c]:a;for(;c<o;)t.insertBefore(n[c++],u)}else if(o===c)for(;r<i;)(!d||!d.has(e[r]))&&e[r].remove(),r++;else if(e[r]===n[o-1]&&n[c]===e[i-1]){const u=e[--i].nextSibling;t.insertBefore(n[c++],e[r++].nextSibling),t.insertBefore(n[--o],u),e[i]=n[o]}else{if(!d){d=new Map;let l=c;for(;l<o;)d.set(n[l],l++)}const u=d.get(e[r]);if(u!=null)if(c<u&&u<o){let l=r,f=1,h;for(;++l<i&&l<o&&!((h=d.get(e[l]))==null||h!==u+f);)f++;if(f>u-c){const _=e[r];for(;c<u;)t.insertBefore(n[c++],_)}else t.replaceChild(n[c++],e[r++])}else r++;else e[r++].remove()}}}const at="_$DX_DELEGATE";function un(t,e,n,s={}){let i;return _e(o=>{i=o,e===document?t():x(e,t(),e.firstChild?null:void 0,n)},s.owner),()=>{i(),e.textContent=""}}function $(t,e,n){let s;const i=()=>{const r=document.createElement("template");return r.innerHTML=t,n?r.content.firstChild.firstChild:r.content.firstChild},o=e?()=>W(()=>document.importNode(s||(s=i()),!0)):()=>(s||(s=i())).cloneNode(!0);return o.cloneNode=o,o}function cn(t,e=window.document){const n=e[at]||(e[at]=new Set);for(let s=0,i=t.length;s<i;s++){const o=t[s];n.has(o)||(n.add(o),e.addEventListener(o,an))}}function dn(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function x(t,e,n,s){if(n!==void 0&&!s&&(s=[]),typeof e!="function")return ge(t,e,s,n);ie(i=>ge(t,e(),i,n),s)}function an(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}});n;){const s=n[e];if(s&&!n.disabled){const i=n[`${e}Data`];if(i!==void 0?s.call(n,i,t):s.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function ge(t,e,n,s,i){for(;typeof n=="function";)n=n();if(e===n)return n;const o=typeof e,r=s!==void 0;if(t=r&&n[0]&&n[0].parentNode||t,o==="string"||o==="number")if(o==="number"&&(e=e.toString()),r){let c=n[0];c&&c.nodeType===3?c.data!==e&&(c.data=e):c=document.createTextNode(e),n=z(t,n,s,c)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e;else if(e==null||o==="boolean")n=z(t,n,s);else{if(o==="function")return ie(()=>{let c=e();for(;typeof c=="function";)c=c();n=ge(t,c,n,s)}),()=>n;if(Array.isArray(e)){const c=[],a=n&&Array.isArray(n);if(je(c,e,n,i))return ie(()=>n=ge(t,c,n,s,!0)),()=>n;if(c.length===0){if(n=z(t,n,s),r)return n}else a?n.length===0?lt(t,c,s):rn(t,n,c):(n&&z(t),lt(t,c));n=c}else if(e.nodeType){if(Array.isArray(n)){if(r)return n=z(t,n,s,e);z(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function je(t,e,n,s){let i=!1;for(let o=0,r=e.length;o<r;o++){let c=e[o],a=n&&n[t.length],d;if(!(c==null||c===!0||c===!1))if((d=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))i=je(t,c,a)||i;else if(d==="function")if(s){for(;typeof c=="function";)c=c();i=je(t,Array.isArray(c)?c:[c],Array.isArray(a)?a:[a])||i}else t.push(c),i=!0;else{const u=String(c);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return i}function lt(t,e,n=null){for(let s=0,i=e.length;s<i;s++)t.insertBefore(e[s],n)}function z(t,e,n,s){if(n===void 0)return t.textContent="";const i=s||document.createTextNode("");if(e.length){let o=!1;for(let r=e.length-1;r>=0;r--){const c=e[r];if(i!==c){const a=c.parentNode===t;!o&&!r?a?t.replaceChild(i,c):t.insertBefore(i,n):a&&c.remove()}else o=!0}}else t.insertBefore(i,n);return[i]}var S=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class ln{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return S(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return S(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return S(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return S(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return S(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return S(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return S(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return S(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(e)>-1})}getConnectionId(){return S(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=s=>{e(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var D=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class fn{constructor(e){this.messageBus=e}reset(){return D(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return D(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return D(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return D(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return D(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return D(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return D(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function hn(t){return typeof t.id=="string"}var Ze={exports:{}},J=typeof Reflect=="object"?Reflect:null,ft=J&&typeof J.apply=="function"?J.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},Ee;J&&typeof J.ownKeys=="function"?Ee=J.ownKeys:Object.getOwnPropertySymbols?Ee=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ee=function(e){return Object.getOwnPropertyNames(e)};function _n(t){console&&console.warn&&console.warn(t)}var Pt=Number.isNaN||function(e){return e!==e};function y(){y.init.call(this)}Ze.exports=y;Ze.exports.once=vn;y.EventEmitter=y;y.prototype._events=void 0;y.prototype._eventsCount=0;y.prototype._maxListeners=void 0;var ht=10;function Se(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return ht},set:function(t){if(typeof t!="number"||t<0||Pt(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ht=t}});y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};y.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Pt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Gt(t){return t._maxListeners===void 0?y.defaultMaxListeners:t._maxListeners}y.prototype.getMaxListeners=function(){return Gt(this)};y.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var r;if(n.length>0&&(r=n[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var a=o[e];if(a===void 0)return!1;if(typeof a=="function")ft(a,this,n);else for(var d=a.length,u=jt(a,d),s=0;s<d;++s)ft(u[s],this,n);return!0};function Ut(t,e,n,s){var i,o,r;if(Se(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),r=o[e]),r===void 0)r=o[e]=n,++t._eventsCount;else if(typeof r=="function"?r=o[e]=s?[n,r]:[r,n]:s?r.unshift(n):r.push(n),i=Gt(t),i>0&&r.length>i&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=r.length,_n(c)}return t}y.prototype.addListener=function(e,n){return Ut(this,e,n,!1)};y.prototype.on=y.prototype.addListener;y.prototype.prependListener=function(e,n){return Ut(this,e,n,!0)};function En(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Vt(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=En.bind(s);return i.listener=n,s.wrapFn=i,i}y.prototype.once=function(e,n){return Se(n),this.on(e,Vt(this,e,n)),this};y.prototype.prependOnceListener=function(e,n){return Se(n),this.prependListener(e,Vt(this,e,n)),this};y.prototype.removeListener=function(e,n){var s,i,o,r,c;if(Se(n),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(o=-1,r=s.length-1;r>=0;r--)if(s[r]===n||s[r].listener===n){c=s[r].listener,o=r;break}if(o<0)return this;o===0?s.shift():yn(s,o),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||n)}return this};y.prototype.off=y.prototype.removeListener;y.prototype.removeAllListeners=function(e){var n,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var o=Object.keys(s),r;for(i=0;i<o.length;++i)r=o[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function $t(t,e,n){var s=t._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?On(i):jt(i,i.length)}y.prototype.listeners=function(e){return $t(this,e,!0)};y.prototype.rawListeners=function(e){return $t(this,e,!1)};y.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ht.call(t,e)};y.prototype.listenerCount=Ht;function Ht(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?Ee(this._events):[]};function jt(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function yn(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function On(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function vn(t,e){return new Promise(function(n,s){function i(r){t.removeListener(e,o),s(r)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}kt(t,e,o,{once:!0}),e!=="error"&&pn(t,i,{once:!0})})}function pn(t,e,n){typeof t.on=="function"&&kt(t,"error",e,n)}function kt(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(o){s.once&&t.removeEventListener(e,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var An=Ze.exports;let ae;const gn=new Uint8Array(16);function Tn(){if(!ae&&(ae=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ae))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ae(gn)}const B=[];for(let t=0;t<256;++t)B.push((t+256).toString(16).slice(1));function mn(t,e=0){return B[t[e+0]]+B[t[e+1]]+B[t[e+2]]+B[t[e+3]]+"-"+B[t[e+4]]+B[t[e+5]]+"-"+B[t[e+6]]+B[t[e+7]]+"-"+B[t[e+8]]+B[t[e+9]]+"-"+B[t[e+10]]+B[t[e+11]]+B[t[e+12]]+B[t[e+13]]+B[t[e+14]]+B[t[e+15]]}const Bn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_t={randomUUID:Bn};function Rn(t,e,n){if(_t.randomUUID&&!e&&!t)return _t.randomUUID();t=t||{};const s=t.random||(t.rng||Tn)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){n=n||0;for(let i=0;i<16;++i)e[n+i]=s[i];return e}return mn(s)}class Cn extends An.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const i=s.data;if(s.origin===this.targetOrigin&&hn(i)){if(i.id==="OBR_READY"){this.ready=!0;const o=i.data;this.ref=o.ref,this.userId=o.userId}this.emit(i.id,i.data)}},this.send=(s,i,o)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:s,data:i,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(s,i,o=5e3)=>{const r=`_${Rn()}`;return this.send(s,i,r),Promise.race([new Promise((c,a)=>{const d=this;function u(f){d.off(`${s}_RESPONSE${r}`,u),d.off(`${s}_ERROR${r}`,l),c(f)}function l(f){d.off(`${s}_RESPONSE${r}`,u),d.off(`${s}_ERROR${r}`,l),a(f)}this.on(`${s}_RESPONSE${r}`,u),this.on(`${s}_ERROR${r}`,l)}),...o>0?[new Promise((c,a)=>window.setTimeout(()=>a(new Error(`Message ${s} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Et=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Sn{constructor(e){this.messageBus=e}show(e,n){return Et(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return s})}close(e){return Et(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var X=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class wn{constructor(e){this.messageBus=e}getColor(){return X(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return X(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return X(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=s=>{e(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var w=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Nn{constructor(e){this.messageBus=e}getDpi(){return w(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return w(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return w(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return w(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return w(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return w(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return w(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,s,i){return w(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:s,useCenter:i});return o})}getDistance(e,n){return w(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return s})}onChange(e){const n=s=>{e(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var le=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class In{constructor(e){this.messageBus=e}undo(){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return le(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return le(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function R(t){for(var e=arguments.length,n=Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function K(t){return!!t&&!!t[M]}function H(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var s=Object.getPrototypeOf(n);if(s===null)return!0;var i=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===Un}(t)||Array.isArray(t)||!!t[ne]||!!(!((e=t.constructor)===null||e===void 0)&&e[ne])||we(t)||Ne(t))}function ee(t,e,n){n===void 0&&(n=!1),j(t)===0?(n?Object.keys:st)(t).forEach(function(s){n&&typeof s=="symbol"||e(s,t[s],t)}):t.forEach(function(s,i){return e(i,s,t)})}function j(t){var e=t[M];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:we(t)?2:Ne(t)?3:0}function oe(t,e){return j(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function ye(t,e){return j(t)===2?t.get(e):t[e]}function Yt(t,e,n){var s=j(t);s===2?t.set(e,n):s===3?t.add(n):t[e]=n}function Mn(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function we(t){return Pn&&t instanceof Map}function Ne(t){return Gn&&t instanceof Set}function Y(t){return t.o||t.t}function qe(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Vn(t);delete e[M];for(var n=st(e),s=0;s<n.length;s++){var i=n[s],o=e[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function Qe(t,e){return e===void 0&&(e=!1),Je(t)||K(t)||!H(t)||(j(t)>1&&(t.set=t.add=t.clear=t.delete=Ln),Object.freeze(t),e&&ee(t,function(n,s){return Qe(s,!0)},!0)),t}function Ln(){R(2)}function Je(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function U(t){var e=We[t];return e||R(18,t),e}function bn(t,e){We[t]||(We[t]=e)}function yt(){return re}function Le(t,e){e&&(U("Patches"),t.u=[],t.s=[],t.v=e)}function Te(t){ke(t),t.p.forEach(Dn),t.p=null}function ke(t){t===re&&(re=t.l)}function Ot(t){return re={p:[],l:re,h:t,m:!0,_:0}}function Dn(t){var e=t[M];e.i===0||e.i===1?e.j():e.g=!0}function be(t,e){e._=e.p.length;var n=e.p[0],s=t!==void 0&&t!==n;return e.h.O||U("ES5").S(e,t,s),s?(n[M].P&&(Te(e),R(4)),H(t)&&(t=me(e,t),e.l||Be(e,t)),e.u&&U("Patches").M(n[M].t,t,e.u,e.s)):t=me(e,n,[]),Te(e),e.u&&e.v(e.u,e.s),t!==nt?t:void 0}function me(t,e,n){if(Je(e))return e;var s=e[M];if(!s)return ee(e,function(c,a){return vt(t,s,e,c,a,n)},!0),e;if(s.A!==t)return e;if(!s.P)return Be(t,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var i=s.i===4||s.i===5?s.o=qe(s.k):s.o,o=i,r=!1;s.i===3&&(o=new Set(i),i.clear(),r=!0),ee(o,function(c,a){return vt(t,s,i,c,a,n,r)}),Be(t,i,!1),n&&t.u&&U("Patches").N(s,n,t.u,t.s)}return s.o}function vt(t,e,n,s,i,o,r){if(K(i)){var c=me(t,i,o&&e&&e.i!==3&&!oe(e.R,s)?o.concat(s):void 0);if(Yt(n,s,c),!K(c))return;t.m=!1}else r&&n.add(i);if(H(i)&&!Je(i)){if(!t.h.D&&t._<1)return;me(t,i),e&&e.A.l||Be(t,i)}}function Be(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&Qe(e,n)}function De(t,e){var n=t[M];return(n?Y(n):t)[e]}function pt(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var s=Object.getOwnPropertyDescriptor(n,e);if(s)return s;n=Object.getPrototypeOf(n)}}function Ye(t){t.P||(t.P=!0,t.l&&Ye(t.l))}function xe(t){t.o||(t.o=qe(t.t))}function Fe(t,e,n){var s=we(e)?U("MapSet").F(e,n):Ne(e)?U("MapSet").T(e,n):t.O?function(i,o){var r=Array.isArray(i),c={i:r?1:0,A:o?o.A:yt(),P:!1,I:!1,R:{},l:o,t:i,k:null,o:null,j:null,C:!1},a=c,d=Ke;r&&(a=[c],d=te);var u=Proxy.revocable(a,d),l=u.revoke,f=u.proxy;return c.k=f,c.j=l,f}(e,n):U("ES5").J(e,n);return(n?n.A:yt()).p.push(s),s}function xn(t){return K(t)||R(22,t),function e(n){if(!H(n))return n;var s,i=n[M],o=j(n);if(i){if(!i.P&&(i.i<4||!U("ES5").K(i)))return i.t;i.I=!0,s=At(n,o),i.I=!1}else s=At(n,o);return ee(s,function(r,c){i&&ye(i.t,r)===c||Yt(s,r,e(c))}),o===3?new Set(s):s}(t)}function At(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return qe(t)}function et(){function t(s){if(!H(s))return s;if(Array.isArray(s))return s.map(t);if(we(s))return new Map(Array.from(s.entries()).map(function(r){return[r[0],t(r[1])]}));if(Ne(s))return new Set(Array.from(s).map(t));var i=Object.create(Object.getPrototypeOf(s));for(var o in s)i[o]=t(s[o]);return oe(s,ne)&&(i[ne]=s[ne]),i}function e(s){return K(s)?t(s):s}var n="add";bn("Patches",{$:function(s,i){return i.forEach(function(o){for(var r=o.path,c=o.op,a=s,d=0;d<r.length-1;d++){var u=j(a),l=r[d];typeof l!="string"&&typeof l!="number"&&(l=""+l),u!==0&&u!==1||l!=="__proto__"&&l!=="constructor"||R(24),typeof a=="function"&&l==="prototype"&&R(24),typeof(a=ye(a,l))!="object"&&R(15,r.join("/"))}var f=j(a),h=t(o.value),_=r[r.length-1];switch(c){case"replace":switch(f){case 2:return a.set(_,h);case 3:R(16);default:return a[_]=h}case n:switch(f){case 1:return _==="-"?a.push(h):a.splice(_,0,h);case 2:return a.set(_,h);case 3:return a.add(h);default:return a[_]=h}case"remove":switch(f){case 1:return a.splice(_,1);case 2:return a.delete(_);case 3:return a.delete(o.value);default:return delete a[_]}default:R(17,c)}}),s},N:function(s,i,o,r){switch(s.i){case 0:case 4:case 2:return function(c,a,d,u){var l=c.t,f=c.o;ee(c.R,function(h,_){var E=ye(l,h),p=ye(f,h),A=_?oe(l,h)?"replace":n:"remove";if(E!==p||A!=="replace"){var O=a.concat(h);d.push(A==="remove"?{op:A,path:O}:{op:A,path:O,value:p}),u.push(A===n?{op:"remove",path:O}:A==="remove"?{op:n,path:O,value:e(E)}:{op:"replace",path:O,value:e(E)})}})}(s,i,o,r);case 5:case 1:return function(c,a,d,u){var l=c.t,f=c.R,h=c.o;if(h.length<l.length){var _=[h,l];l=_[0],h=_[1];var E=[u,d];d=E[0],u=E[1]}for(var p=0;p<l.length;p++)if(f[p]&&h[p]!==l[p]){var A=a.concat([p]);d.push({op:"replace",path:A,value:e(h[p])}),u.push({op:"replace",path:A,value:e(l[p])})}for(var O=l.length;O<h.length;O++){var v=a.concat([O]);d.push({op:n,path:v,value:e(h[O])})}l.length<h.length&&u.push({op:"replace",path:a.concat(["length"]),value:l.length})}(s,i,o,r);case 3:return function(c,a,d,u){var l=c.t,f=c.o,h=0;l.forEach(function(_){if(!f.has(_)){var E=a.concat([h]);d.push({op:"remove",path:E,value:_}),u.unshift({op:n,path:E,value:_})}h++}),h=0,f.forEach(function(_){if(!l.has(_)){var E=a.concat([h]);d.push({op:n,path:E,value:_}),u.unshift({op:"remove",path:E,value:_})}h++})}(s,i,o,r)}},M:function(s,i,o,r){o.push({op:"replace",path:[],value:i===nt?void 0:i}),r.push({op:"replace",path:[],value:s})}})}var gt,re,tt=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Pn=typeof Map<"u",Gn=typeof Set<"u",Tt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",nt=tt?Symbol.for("immer-nothing"):((gt={})["immer-nothing"]=!0,gt),ne=tt?Symbol.for("immer-draftable"):"__$immer_draftable",M=tt?Symbol.for("immer-state"):"__$immer_state",Un=""+Object.prototype.constructor,st=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Vn=Object.getOwnPropertyDescriptors||function(t){var e={};return st(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},We={},Ke={get:function(t,e){if(e===M)return t;var n=Y(t);if(!oe(n,e))return function(i,o,r){var c,a=pt(o,r);return a?"value"in a?a.value:(c=a.get)===null||c===void 0?void 0:c.call(i.k):void 0}(t,n,e);var s=n[e];return t.I||!H(s)?s:s===De(t.t,e)?(xe(t),t.o[e]=Fe(t.A.h,s,t)):s},has:function(t,e){return e in Y(t)},ownKeys:function(t){return Reflect.ownKeys(Y(t))},set:function(t,e,n){var s=pt(Y(t),e);if(s?.set)return s.set.call(t.k,n),!0;if(!t.P){var i=De(Y(t),e),o=i?.[M];if(o&&o.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Mn(n,i)&&(n!==void 0||oe(t.t,e)))return!0;xe(t),Ye(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return De(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,xe(t),Ye(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Y(t),s=Reflect.getOwnPropertyDescriptor(n,e);return s&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:s.enumerable,value:n[e]}},defineProperty:function(){R(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){R(12)}},te={};ee(Ke,function(t,e){te[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),te.deleteProperty=function(t,e){return te.set.call(this,t,e,void 0)},te.set=function(t,e,n){return Ke.set.call(this,t[0],e,n,t[0])};var $n=function(){function t(n){var s=this;this.O=Tt,this.D=!0,this.produce=function(i,o,r){if(typeof i=="function"&&typeof o!="function"){var c=o;o=i;var a=s;return function(E){var p=this;E===void 0&&(E=c);for(var A=arguments.length,O=Array(A>1?A-1:0),v=1;v<A;v++)O[v-1]=arguments[v];return a.produce(E,function(I){var b;return(b=o).call.apply(b,[p,I].concat(O))})}}var d;if(typeof o!="function"&&R(6),r!==void 0&&typeof r!="function"&&R(7),H(i)){var u=Ot(s),l=Fe(s,i,void 0),f=!0;try{d=o(l),f=!1}finally{f?Te(u):ke(u)}return typeof Promise<"u"&&d instanceof Promise?d.then(function(E){return Le(u,r),be(E,u)},function(E){throw Te(u),E}):(Le(u,r),be(d,u))}if(!i||typeof i!="object"){if((d=o(i))===void 0&&(d=i),d===nt&&(d=void 0),s.D&&Qe(d,!0),r){var h=[],_=[];U("Patches").M(i,d,h,_),r(h,_)}return d}R(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(d){for(var u=arguments.length,l=Array(u>1?u-1:0),f=1;f<u;f++)l[f-1]=arguments[f];return s.produceWithPatches(d,function(h){return i.apply(void 0,[h].concat(l))})};var r,c,a=s.produce(i,o,function(d,u){r=d,c=u});return typeof Promise<"u"&&a instanceof Promise?a.then(function(d){return[d,r,c]}):[a,r,c]},typeof n?.useProxies=="boolean"&&this.setUseProxies(n.useProxies),typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){H(n)||R(8),K(n)&&(n=xn(n));var s=Ot(this),i=Fe(this,n,void 0);return i[M].C=!0,ke(s),i},e.finishDraft=function(n,s){var i=n&&n[M],o=i.A;return Le(o,s),be(void 0,o)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Tt&&R(20),this.O=n},e.applyPatches=function(n,s){var i;for(i=s.length-1;i>=0;i--){var o=s[i];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}i>-1&&(s=s.slice(i+1));var r=U("Patches").$;return K(n)?r(n,s):this.produce(n,function(c){return r(c,s)})},t}(),L=new $n;L.produce;var it=L.produceWithPatches.bind(L);L.setAutoFreeze.bind(L);L.setUseProxies.bind(L);L.applyPatches.bind(L);L.createDraft.bind(L);L.finishDraft.bind(L);var Z=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};et();class Hn{constructor(e){this.messageBus=e}getItems(e){return Z(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,s=!0){return Z(this,void 0,void 0,function*(){let i;this.isItemArray(e)?i=e:i=yield this.getItems(e);const[o,r]=it(i,n),c=o.map(d=>({id:d.id,type:d.type}));for(const d of r){const[u,l]=d.path;typeof u=="number"&&typeof l=="string"&&(c[u][l]=o[u][l])}const a=c.filter(d=>Object.keys(d).length>2);a.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:a,updateAttachments:s}))})}addItems(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return Z(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return Z(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var q=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};et();class jn{constructor(e){this.messageBus=e}getItems(e){return q(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,s,i=!0){return q(this,void 0,void 0,function*(){const o=yield this.getItems(e),[r,c]=it(o,n),a=r.map(u=>({id:u.id,type:u.type}));for(const u of c){const[l,f]=u.path;typeof l=="number"&&typeof f=="string"&&(a[l][f]=r[l][f])}const d=a.filter(u=>Object.keys(u).length>2);d.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:d,fastUpdate:s,updateAttachments:i}))})}addItems(e){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return q(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return q(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var Pe=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class kn{constructor(e){this.messageBus=e,this.grid=new Nn(e),this.fog=new wn(e),this.history=new In(e),this.items=new Hn(e),this.local=new jn(e)}isReady(){return Pe(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=s=>{e(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return Pe(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=s=>{e(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Ft(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function se(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Ft(e.icon)}))}function ot(t){return Object.assign(Object.assign({},t),{url:Ft(t.url)})}var mt=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Yn{constructor(e){this.contextMenus={},this.handleClick=n=>{var s;const i=this.contextMenus[n.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return mt(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:se(e.icons),embed:e.embed&&ot(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return mt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var P=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Fn{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const s=this.tools[n.id];if(s)if(s.onClick){const i=s.onClick(n.context,n.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var s;const i=this.toolActions[n.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,n.context,n.elementId))},this.handleToolModeClick=n=>{const s=this.toolModes[n.id];if(s)if(s.onClick){const i=s.onClick(n.context,n.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const s=this.toolModes[n.id];if(s)if(s.onToolClick){const i=s.onToolClick(n.context,n.event);Promise.resolve(i).then(o=>{o&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const s=this.toolModes[n.id];if(s)if(s.onToolDoubleClick){const i=s.onToolDoubleClick(n.context,n.event);Promise.resolve(i).then(o=>{o&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolDown)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolMove=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolMove)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolUp=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolUp)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolDragStart)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolDragMove)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolDragEnd)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onToolDragCancel)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeKeyDown=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onKeyDown)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeKeyUp=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onKeyUp)===null||s===void 0||s.call(i,n.context,n.event))},this.handleToolModeActivate=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onActivate)===null||s===void 0||s.call(i,n.context))},this.handleToolModeDeactivate=n=>{var s;const i=this.toolModes[n.id];i&&((s=i.onDeactivate)===null||s===void 0||s.call(i,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:se(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return P(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:se(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:se(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var Q=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Wn{constructor(e){this.messageBus=e}open(e){return Q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ot(e)))})}close(e){return Q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return Q(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return Q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return Q(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return Q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var Bt=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Kn{constructor(e){this.messageBus=e}open(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ot(e)))})}close(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var N=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class zn{constructor(e){this.messageBus=e}getWidth(){return N(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return N(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return N(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return N(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return N(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return N(this,void 0,void 0,function*(){const n=se([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return N(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return N(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=s=>{e(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Xn=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};et();class Zn{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Xn(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let i=e;return[c=>{const[a,d]=it(i,c);return i=a,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:s,patches:d}),a},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:s})}]})}}var qn=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Qn{constructor(e){this.messageBus=e}getPlayers(){return qn(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=s=>{e(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var Ge=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class Jn{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return Ge(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return Ge(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return Ge(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=s=>{e(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=s=>{e(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var es=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class ts{constructor(e){this.messageBus=e}getTheme(){return es(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=s=>{e(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var fe=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class ns{constructor(e){this.messageBus=e}uploadImages(e,n){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,s){return fe(this,void 0,void 0,function*(){const{images:i}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:s},-1);return i})}downloadScenes(e,n){return fe(this,void 0,void 0,function*(){const{scenes:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return s})}}var ss=function(t,e,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(u){try{d(s.next(u))}catch(l){r(l)}}function a(u){try{d(s.throw(u))}catch(l){r(l)}}function d(u){u.done?o(u.value):i(u.value).then(c,a)}d((s=s.apply(t,e||[])).next())})};class is{constructor(e){this.messageBus=e}sendMessage(e,n){return ss(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const rt=typeof Buffer=="function",Rt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const os="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rs=Array.prototype.slice.call(os),he=(t=>{let e={};return t.forEach((n,s)=>e[n]=s),e})(rs),us=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,F=String.fromCharCode.bind(String),Ct=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Wt=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),cs=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ds=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return F((n>>>10)+55296)+F((n&1023)+56320);case 3:return F((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return F((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},as=t=>t.replace(cs,ds),ls=t=>{if(t=t.replace(/\s+/g,""),!us.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",s,i;for(let o=0;o<t.length;)e=he[t.charAt(o++)]<<18|he[t.charAt(o++)]<<12|(s=he[t.charAt(o++)])<<6|(i=he[t.charAt(o++)]),n+=s===64?F(e>>16&255):i===64?F(e>>16&255,e>>8&255):F(e>>16&255,e>>8&255,e&255);return n},Kt=typeof atob=="function"?t=>atob(Wt(t)):rt?t=>Buffer.from(t,"base64").toString("binary"):ls,fs=rt?t=>Ct(Buffer.from(t,"base64")):t=>Ct(Kt(t).split("").map(e=>e.charCodeAt(0))),hs=rt?t=>Buffer.from(t,"base64").toString("utf8"):Rt?t=>Rt.decode(fs(t)):t=>as(Kt(t)),_s=t=>Wt(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Es=t=>hs(_s(t));function ys(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",s="";if(e){const o=Es(e).split(" ");o.length===2&&(n=o[0],s=o[1])}return{origin:n,roomId:s}}var St;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(St||(St={}));const ze=ys(),m=new Cn(ze.origin,ze.roomId),Os=new fn(m),vs=new ln(m),ps=new Qn(m),As=new Sn(m),gs=new kn(m),Ts=new Yn(m),ms=new Fn(m),Bs=new Wn(m),Rs=new Kn(m),Cs=new zn(m),Ss=new Zn(m),ws=new Jn(m),Ns=new ts(m),Is=new ns(m),Ms=new is(m),Ls={onReady:t=>{m.ready?t():m.once("OBR_READY",()=>t())},get isReady(){return m.ready},viewport:Os,player:vs,party:ps,notification:As,scene:gs,contextMenu:Ts,tool:ms,popover:Bs,modal:Rs,action:Cs,interaction:Ss,room:ws,theme:Ns,assets:Is,broadcast:Ms,isAvailable:!!ze.origin},bs=["Blinded","Charmed","Deafened","Exhaustion 1","Exhaustion 2","Exhaustion 3","Exhaustion 4","Exhaustion 5","Exhaustion 6","Frightened","Grappled","Incapacitated","Invisible","Paralyzed","Petrified","Poisoned","Prone","Restrained","Stunned","Unconscious"],Ue={START:"beyond-encounter-tracker.encounter.start",END:"beyond-encounter-tracker.encounter.end",UPDATE:"beyond-encounter-tracker.encounter.update"},Ds=t=>e=>{e.id===Ue.START?t.onEncounterStarted(e.encounter):e.id===Ue.END?t.onEncounterEnded(e.encounterId):e.id===Ue.UPDATE&&t.onEncounterUpdated(e.encounter)},ut={GET:"beyond-encounter-tracker.encounter.get",ADD_CONDITION:"beyond-encounter-tracker.encounter.add-condition",REMOVE_CONDITION:"beyond-encounter-tracker.encounter.remove-condition"},xs=()=>({id:ut.GET}),Ps=(t,e)=>({id:ut.ADD_CONDITION,combatantName:t,condition:e}),Gs=(t,e)=>({id:ut.REMOVE_CONDITION,combatantName:t,condition:e});var Us=$("<select><option disabled selected>Add Condition"),Vs=$("<option>"),$s=$("<ul>"),Hs=$("<li><a><span>"),js=$("<h1>No active encounter"),ks=$("<h1>"),Ys=$("<table class=encounter>"),Fs=$("<div>"),Ws=$("<tr><td><img style=width:40px;height:40px;></td><td style=width:100%><table><tbody><tr><td><span style=white-space:nowrap></span></td></tr><tr><td class=conditions>");const Ks=async()=>await Ls.player.getRole()==="GM",Ve=t=>{window.parent.postMessage(t,"*")},zs=()=>{const[t,e]=$e();ct(()=>{const i=Ds({onEncounterStarted(r){e(r)},onEncounterUpdated(r){e(r)},onEncounterEnded(r){e(void 0)}}),o=r=>{console.log("Message received",r),i(r.data)};window.addEventListener("message",o),Ve(xs()),It(()=>{window.removeEventListener("message",o)})});const n=i=>{const o=r=>{i.onChange(r.target.value),r.target.selectedIndex=0};return(()=>{var r=Us();return r.firstChild,r.addEventListener("change",o),x(r,G(Me,{each:bs,children:c=>(()=>{var a=Vs();return a.value=c,x(a,c),ie(()=>a.disabled=i.selected.indexOf(c)>=0),a})()}),null),r})()},s=i=>{const[o,r]=$e(!1);ct(async()=>{r(await Ks())});const c=d=>{Ve(Ps(i.combatant.name,d))},a=d=>{Ve(Gs(i.combatant.name,d))};return[G(de,{get when(){return i.combatant.conditions.length>0},get children(){var d=$s();return x(d,G(Me,{get each(){return i.combatant.conditions},children:u=>(()=>{var l=Hs(),f=l.firstChild,h=f.firstChild;return f.$$click=()=>a(u),x(h,u),l})()})),d}}),G(de,{get when(){return o()},get children(){return G(n,{onChange:c,get selected(){return i.combatant.conditions}})}})]};return(()=>{var i=Fs();return x(i,G(de,{get when(){return!t()},get children(){return js()}}),null),x(i,G(de,{get when(){return t()},get children(){return[(()=>{var o=ks();return x(o,()=>t().title),o})(),(()=>{var o=Ys();return x(o,G(Me,{get each(){return t().combatants},children:(r,c)=>(()=>{var a=Ws(),d=a.firstChild,u=d.firstChild,l=d.nextSibling,f=l.firstChild,h=f.firstChild,_=h.firstChild,E=_.firstChild,p=E.firstChild,A=_.nextSibling,O=A.firstChild;return x(p,()=>r.name),x(O,G(s,{combatant:r})),ie(v=>{var I=t().active===c(),b=r.avatar;return I!==v.e&&a.classList.toggle("active",v.e=I),b!==v.t&&dn(u,"src",v.t=b),v},{e:void 0,t:void 0}),a})()})),o})()]}}),null),i})()};cn(["click"]);const Xs=document.getElementById("root");un(()=>G(zs,{}),Xs);
